<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZerohedgeQuant ‚Äî Indian Market Intelligence</title>
<style>
:root {
  --bg-primary: #0a0e17; --bg-secondary: #111827; --bg-card: #1a2035; --bg-hover: #243049;
  --border: #2a3555; --text-primary: #e8edf5; --text-secondary: #94a3b8; --text-muted: #64748b;
  --accent: #3b82f6; --accent2: #8b5cf6; --green: #22c55e; --red: #ef4444; --yellow: #eab308;
  --orange: #f97316; --cyan: #06b6d4;
  --nav-h: 52px; --ticker-h: 36px;
}
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'SF Pro Display',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif; background:var(--bg-primary); color:var(--text-primary); overflow-x:hidden; line-height:1.5; }
a { color:var(--accent); text-decoration:none; }
::-webkit-scrollbar { width:6px; height:6px; }
::-webkit-scrollbar-track { background:var(--bg-primary); }
::-webkit-scrollbar-thumb { background:var(--border); border-radius:3px; }

.ticker-bar { height:var(--ticker-h); background:var(--bg-secondary); border-bottom:1px solid var(--border); display:flex; align-items:center; overflow:hidden; font-size:12px; position:fixed; top:0; left:0; right:0; z-index:1001; }
.ticker-content { display:flex; gap:28px; padding:0 16px; animation:tickerScroll 40s linear infinite; white-space:nowrap; }
@keyframes tickerScroll { 0%{transform:translateX(0)} 100%{transform:translateX(-50%)} }
.ticker-item { display:flex; gap:8px; align-items:center; }
.ticker-name { color:var(--text-secondary); font-weight:500; }
.ticker-value { color:var(--text-primary); font-weight:600; }
.ticker-change { font-weight:600; font-size:11px; }

.navbar { height:var(--nav-h); background:rgba(17,24,39,0.95); backdrop-filter:blur(12px); border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; padding:0 24px; position:fixed; top:var(--ticker-h); left:0; right:0; z-index:1000; }
.nav-brand { font-size:18px; font-weight:700; background:linear-gradient(135deg,var(--accent),var(--accent2)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; cursor:pointer; }
.nav-links { display:flex; gap:4px; }
.nav-link { padding:8px 14px; border-radius:6px; font-size:13px; font-weight:500; color:var(--text-secondary); cursor:pointer; transition:all .2s; border:none; background:none; }
.nav-link:hover { color:var(--text-primary); background:var(--bg-hover); }
.nav-link.active { color:var(--accent); background:rgba(59,130,246,.1); }
.nav-right { display:flex; align-items:center; gap:12px; }
.live-badge { display:flex; align-items:center; gap:6px; font-size:11px; font-weight:600; color:var(--green); background:rgba(34,197,94,.1); padding:4px 10px; border-radius:20px; }
.live-dot { width:7px; height:7px; background:var(--green); border-radius:50%; animation:pulse 1.5s infinite; }
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.4} }
.market-time { font-size:11px; color:var(--text-muted); }

.main { margin-top:calc(var(--nav-h)+var(--ticker-h)); padding:20px 24px; max-width:1440px; margin-left:auto; margin-right:auto; }
.page { display:none; } .page.active { display:block; }

/* Search */
.home-search { max-width:600px; margin:0 auto 28px; position:relative; }
.search-input { width:100%; padding:12px 18px 12px 42px; background:var(--bg-card); border:1px solid var(--border); border-radius:10px; color:var(--text-primary); font-size:15px; outline:none; }
.search-input:focus { border-color:var(--accent); }
.search-input::placeholder { color:var(--text-muted); }
.search-icon { position:absolute; left:14px; top:50%; transform:translateY(-50%); color:var(--text-muted); }
.search-results { position:absolute; top:100%; left:0; right:0; background:var(--bg-card); border:1px solid var(--border); border-radius:0 0 10px 10px; max-height:300px; overflow-y:auto; display:none; z-index:100; }
.search-results.show { display:block; }
.search-result-item { padding:10px 16px; cursor:pointer; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; }
.search-result-item:hover { background:var(--bg-hover); }
.sr-symbol { font-weight:600; color:var(--accent); }
.sr-name { font-size:13px; color:var(--text-secondary); }
.sr-sector { font-size:11px; color:var(--text-muted); background:rgba(100,116,139,.15); padding:2px 8px; border-radius:4px; }

/* Index cards */
.indices-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:14px; margin-bottom:28px; }
.index-card { background:var(--bg-card); border:1px solid var(--border); border-radius:10px; padding:16px; transition:transform .2s; }
.index-card:hover { transform:translateY(-2px); border-color:var(--accent); }
.idx-name { font-size:12px; color:var(--text-muted); font-weight:500; text-transform:uppercase; letter-spacing:.5px; }
.idx-value { font-size:22px; font-weight:700; margin:4px 0; }
.idx-change { font-size:13px; font-weight:600; }

/* Movers */
.section-title { font-size:16px; font-weight:600; margin-bottom:14px; display:flex; align-items:center; gap:8px; }
.movers-grid { display:grid; grid-template-columns:1fr 1fr; gap:14px; margin-bottom:28px; }
.movers-card { background:var(--bg-card); border:1px solid var(--border); border-radius:10px; overflow:hidden; }
.movers-header { padding:12px 16px; font-weight:600; font-size:13px; border-bottom:1px solid var(--border); }
.mover-row { display:flex; justify-content:space-between; align-items:center; padding:8px 16px; border-bottom:1px solid rgba(42,53,85,.4); font-size:13px; cursor:pointer; }
.mover-row:hover { background:var(--bg-hover); }
.mover-symbol { font-weight:600; min-width:90px; }
.mover-price { color:var(--text-secondary); }
.mover-change { font-weight:600; min-width:70px; text-align:right; }
.up { color:var(--green); } .down { color:var(--red); }

/* Screener */
.screener-tabs { display:flex; gap:2px; margin-bottom:0; background:var(--bg-secondary); border-radius:8px 8px 0 0; overflow:hidden; border:1px solid var(--border); border-bottom:none; }
.scr-tab { padding:10px 20px; font-size:13px; font-weight:500; cursor:pointer; color:var(--text-secondary); background:transparent; border:none; }
.scr-tab:hover { color:var(--text-primary); background:var(--bg-hover); }
.scr-tab.active { color:var(--accent); background:var(--bg-card); font-weight:600; }
.filter-panel { background:var(--bg-card); border:1px solid var(--border); border-top:none; padding:14px 16px; display:none; }
.filter-panel.active { display:block; }
.filter-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(180px,1fr)); gap:8px; }
.filter-select { width:100%; padding:7px 28px 7px 10px; background:var(--bg-secondary); border:1px solid var(--border); border-radius:4px; color:var(--text-primary); font-size:12px; cursor:pointer; outline:none; appearance:none; background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%2394a3b8'%3E%3Cpath d='M6 8L1 3h10z'/%3E%3C/svg%3E"); background-repeat:no-repeat; background-position:right 8px center; }
.filter-select option { background:var(--bg-secondary); }
.filter-actions { display:flex; gap:8px; margin-top:10px; padding-top:10px; border-top:1px solid var(--border); }
.btn { padding:6px 16px; border-radius:5px; font-size:12px; font-weight:600; cursor:pointer; border:1px solid var(--border); background:var(--bg-secondary); color:var(--text-primary); }
.btn:hover { background:var(--bg-hover); }
.btn-primary { background:var(--accent); border-color:var(--accent); color:#fff; }
.btn-primary:hover { background:#2563eb; }
.screener-subtabs { display:flex; gap:0; border:1px solid var(--border); border-top:none; background:var(--bg-card); overflow-x:auto; }
.sub-tab { padding:8px 16px; font-size:12px; font-weight:500; cursor:pointer; color:var(--text-muted); background:none; border:none; border-right:1px solid var(--border); white-space:nowrap; }
.sub-tab:hover { color:var(--text-primary); background:var(--bg-hover); }
.sub-tab.active { color:var(--accent); background:rgba(59,130,246,.08); }
.table-wrapper { overflow-x:auto; border:1px solid var(--border); border-top:none; border-radius:0 0 8px 8px; }
.data-table { width:100%; border-collapse:collapse; font-size:12px; }
.data-table th { padding:8px 12px; text-align:left; background:var(--bg-secondary); color:var(--text-muted); font-weight:600; font-size:11px; text-transform:uppercase; letter-spacing:.3px; border-bottom:1px solid var(--border); position:sticky; top:0; cursor:pointer; white-space:nowrap; user-select:none; }
.data-table th:hover { color:var(--text-primary); }
.data-table th.sorted { color:var(--accent); }
.data-table td { padding:7px 12px; border-bottom:1px solid rgba(42,53,85,.3); white-space:nowrap; }
.data-table tr:hover { background:var(--bg-hover); }
.stock-link { color:var(--accent); font-weight:600; cursor:pointer; }
.stock-link:hover { text-decoration:underline; }
.pagination { display:flex; justify-content:space-between; align-items:center; padding:10px 16px; background:var(--bg-card); border:1px solid var(--border); border-top:none; border-radius:0 0 8px 8px; font-size:12px; color:var(--text-muted); }
.page-btns { display:flex; gap:4px; }
.page-btn { padding:4px 10px; border-radius:4px; border:1px solid var(--border); background:var(--bg-secondary); color:var(--text-primary); font-size:12px; cursor:pointer; }
.page-btn.active { background:var(--accent); border-color:var(--accent); color:#fff; }
.page-btn:disabled { opacity:.4; cursor:not-allowed; }

/* Option Chain */
.oc-controls { display:flex; gap:12px; align-items:center; margin-bottom:16px; flex-wrap:wrap; }
.oc-select { padding:8px 14px; background:var(--bg-card); border:1px solid var(--border); border-radius:6px; color:var(--text-primary); font-size:13px; outline:none; }
.oc-select option { background:var(--bg-secondary); }
.spot-display { margin-left:auto; background:var(--bg-card); border:1px solid var(--border); border-radius:8px; padding:8px 16px; display:flex; align-items:center; gap:10px; }
.spot-label { font-size:12px; color:var(--text-muted); }
.spot-val { font-size:18px; font-weight:700; color:var(--accent); }
.oc-table-wrap { overflow-x:auto; border:1px solid var(--border); border-radius:8px; }
.oc-table { width:100%; border-collapse:collapse; font-size:12px; }
.oc-table th { padding:8px 10px; font-size:11px; text-transform:uppercase; font-weight:600; border-bottom:2px solid var(--border); white-space:nowrap; }
.oc-table .call-header { background:rgba(34,197,94,.08); color:var(--green); }
.oc-table .put-header { background:rgba(239,68,68,.08); color:var(--red); }
.oc-table .strike-header { background:var(--bg-secondary); color:var(--yellow); text-align:center; }
.oc-table td { padding:6px 10px; border-bottom:1px solid rgba(42,53,85,.3); text-align:right; }
.oc-table .call-cell { background:rgba(34,197,94,.03); }
.oc-table .put-cell { background:rgba(239,68,68,.03); }
.oc-table .strike-cell { text-align:center; font-weight:700; background:var(--bg-secondary); color:var(--yellow); font-size:13px; }
.oc-table .itm-call { background:rgba(34,197,94,.08); }
.oc-table .itm-put { background:rgba(239,68,68,.08); }
.oc-table .atm { background:rgba(234,179,8,.12) !important; }

/* Stock Detail */
.stock-header { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:20px; flex-wrap:wrap; gap:12px; }
.stock-title-area h2 { font-size:24px; font-weight:700; display:flex; align-items:center; gap:10px; }
.stock-tag { font-size:11px; padding:3px 8px; border-radius:4px; background:rgba(59,130,246,.12); color:var(--accent); font-weight:500; }
.stock-price-area { text-align:right; }
.stock-price { font-size:28px; font-weight:700; }
.stock-change-line { font-size:14px; font-weight:600; }
.stock-stats-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(160px,1fr)); gap:10px; margin-bottom:24px; }
.stat-box { background:var(--bg-card); border:1px solid var(--border); border-radius:8px; padding:12px; }
.stat-label { font-size:11px; color:var(--text-muted); text-transform:uppercase; letter-spacing:.3px; }
.stat-value { font-size:16px; font-weight:600; margin-top:4px; }
.back-btn { display:inline-flex; align-items:center; gap:6px; margin-bottom:16px; padding:6px 12px; background:var(--bg-card); border:1px solid var(--border); border-radius:6px; color:var(--text-secondary); cursor:pointer; font-size:13px; }
.back-btn:hover { color:var(--text-primary); border-color:var(--accent); }
.data-source { font-size:11px; color:var(--text-muted); margin-top:6px; padding:6px 12px; background:rgba(100,116,139,.08); border-radius:6px; display:inline-block; }

/* Coming Soon */
.coming-soon { text-align:center; padding:80px 24px; }
.coming-soon-icon { font-size:64px; margin-bottom:20px; }
.coming-soon h2 { font-size:28px; font-weight:700; margin-bottom:12px; background:linear-gradient(135deg,var(--accent),var(--accent2)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
.coming-soon p { color:var(--text-secondary); font-size:15px; max-width:500px; margin:0 auto; line-height:1.7; }

/* Learning Hub */
.learning-cats { display:flex; gap:8px; margin-bottom:20px; flex-wrap:wrap; }
.cat-btn { padding:6px 16px; border-radius:20px; border:1px solid var(--border); background:var(--bg-card); color:var(--text-secondary); font-size:12px; font-weight:500; cursor:pointer; }
.cat-btn:hover,.cat-btn.active { background:var(--accent); border-color:var(--accent); color:#fff; }
.articles-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(300px,1fr)); gap:16px; }
.article-card { background:var(--bg-card); border:1px solid var(--border); border-radius:10px; padding:20px; cursor:pointer; transition:all .2s; }
.article-card:hover { transform:translateY(-2px); border-color:var(--accent); }
.article-level { display:inline-block; font-size:10px; font-weight:600; text-transform:uppercase; padding:2px 8px; border-radius:4px; margin-bottom:8px; }
.level-beginner { background:rgba(34,197,94,.12); color:var(--green); }
.level-intermediate { background:rgba(234,179,8,.12); color:var(--yellow); }
.level-advanced { background:rgba(239,68,68,.12); color:var(--red); }
.article-title { font-size:15px; font-weight:600; margin-bottom:6px; }
.article-desc { font-size:13px; color:var(--text-secondary); line-height:1.5; }
.article-meta { margin-top:10px; font-size:11px; color:var(--text-muted); display:flex; gap:16px; }

.spinner { width:28px; height:28px; border:3px solid var(--border); border-top-color:var(--accent); border-radius:50%; animation:spin .8s linear infinite; margin:0 auto 8px; }
@keyframes spin { to{transform:rotate(360deg)} }

@media(max-width:768px) {
  .main{padding:14px} .navbar{padding:0 12px} .nav-link{padding:6px 8px;font-size:12px}
  .movers-grid{grid-template-columns:1fr} .indices-grid{grid-template-columns:repeat(2,1fr)}
  .filter-grid{grid-template-columns:repeat(2,1fr)} .oc-controls{flex-direction:column;align-items:stretch}
  .spot-display{margin-left:0}
}
</style>
</head>
<body>

<div class="ticker-bar"><div class="ticker-content" id="tickerContent"><span class="ticker-item"><span class="ticker-name">Loading market data...</span></span></div></div>

<nav class="navbar">
  <div class="nav-brand" onclick="showPage('home')">ZerohedgeQuant</div>
  <div class="nav-links">
    <button class="nav-link active" onclick="showPage('home')">Home</button>
    <button class="nav-link" onclick="showPage('screener')">Screener</button>
    <button class="nav-link" onclick="showPage('optionchain')">Option Chain</button>
    <button class="nav-link" onclick="showPage('ratings')">Rating Tracker</button>
    <button class="nav-link" onclick="showPage('learning')">Learning Hub</button>
  </div>
  <div class="nav-right">
    <div class="live-badge" id="liveBadge"><span class="live-dot"></span><span id="liveStatus">Connecting...</span></div>
    <div class="market-time" id="marketTime"></div>
  </div>
</nav>

<div class="main">

  <!-- HOME -->
  <div id="home" class="page active">
    <div class="home-search">
      <span class="search-icon">üîç</span>
      <input class="search-input" id="searchInput" type="text" placeholder="Search stocks ‚Äî try RELIANCE, TCS, Infosys..." autocomplete="off">
      <div class="search-results" id="searchResults"></div>
    </div>
    <div class="indices-grid" id="indicesGrid"></div>
    <div class="section-title">üìà Market Movers</div>
    <div class="movers-grid">
      <div class="movers-card"><div class="movers-header" style="color:var(--green)">‚ñ≤ Top Gainers</div><div id="topGainers"><div class="mover-row"><span style="color:var(--text-muted)">Loading...</span></div></div></div>
      <div class="movers-card"><div class="movers-header" style="color:var(--red)">‚ñº Top Losers</div><div id="topLosers"><div class="mover-row"><span style="color:var(--text-muted)">Loading...</span></div></div></div>
    </div>
  </div>

  <!-- SCREENER -->
  <div id="screener" class="page">
    <div class="screener-tabs">
      <button class="scr-tab active" onclick="switchScreenerTab('descriptive')">Descriptive</button>
      <button class="scr-tab" onclick="switchScreenerTab('fundamental')">Fundamental</button>
      <button class="scr-tab" onclick="switchScreenerTab('technical')">Technical</button>
    </div>
    <div class="filter-panel active" id="filter-descriptive">
      <div class="filter-grid">
        <select class="filter-select" id="f-sector"><option value="">Sector</option></select>
        <select class="filter-select" id="f-industry"><option value="">Industry</option></select>
        <select class="filter-select" id="f-change"><option value="">Change</option><option>Up &gt;5%</option><option>Up &gt;2%</option><option>Up</option><option>Down</option><option>Down &gt;2%</option><option>Down &gt;5%</option></select>
        <select class="filter-select" id="f-price"><option value="">Price</option><option>Under ‚Çπ100</option><option>‚Çπ100-500</option><option>‚Çπ500-2000</option><option>‚Çπ2000-5000</option><option>Over ‚Çπ5000</option></select>
        <select class="filter-select" id="f-analyst"><option value="">Analyst Rec.</option><option>strong_buy</option><option>buy</option><option>hold</option><option>sell</option><option>strong_sell</option></select>
      </div>
      <div class="filter-actions"><button class="btn btn-primary" onclick="applyFilters()">Apply</button><button class="btn" onclick="resetFilters()">Reset</button><span style="margin-left:auto;font-size:12px;color:var(--text-muted)" id="filterCount"></span></div>
    </div>
    <div class="filter-panel" id="filter-fundamental">
      <div class="filter-grid">
        <select class="filter-select" id="f-pe"><option value="">P/E</option><option>Under 10</option><option>Under 15</option><option>Under 20</option><option>Under 30</option><option>Over 30</option></select>
        <select class="filter-select" id="f-pb"><option value="">P/B</option><option>Under 1</option><option>Under 2</option><option>Under 3</option><option>Over 5</option></select>
        <select class="filter-select" id="f-roe"><option value="">ROE</option><option>Over 30%</option><option>Over 20%</option><option>Over 15%</option><option>Under 10%</option></select>
        <select class="filter-select" id="f-de"><option value="">Debt/Equity</option><option>Under 0.5</option><option>Under 1</option><option>Under 2</option><option>Over 2</option></select>
        <select class="filter-select" id="f-nm"><option value="">Net Margin</option><option>Over 20%</option><option>Over 10%</option><option>Under 10%</option></select>
      </div>
      <div class="filter-actions"><button class="btn btn-primary" onclick="applyFilters()">Apply</button><button class="btn" onclick="resetFilters()">Reset</button><span style="margin-left:auto;font-size:12px;color:var(--text-muted)" id="filterCount2"></span></div>
    </div>
    <div class="filter-panel" id="filter-technical">
      <div class="filter-grid">
        <select class="filter-select" id="f-sma50"><option value="">Price vs SMA50</option><option>Above SMA50</option><option>Below SMA50</option></select>
        <select class="filter-select" id="f-sma200"><option value="">Price vs SMA200</option><option>Above SMA200</option><option>Below SMA200</option></select>
        <select class="filter-select" id="f-beta"><option value="">Beta</option><option>Over 1.5</option><option>Over 1</option><option>Under 1</option></select>
      </div>
      <div class="filter-actions"><button class="btn btn-primary" onclick="applyFilters()">Apply</button><button class="btn" onclick="resetFilters()">Reset</button><span style="margin-left:auto;font-size:12px;color:var(--text-muted)" id="filterCount3"></span></div>
    </div>
    <div class="screener-subtabs">
      <button class="sub-tab active" onclick="switchSubTab('overview')">Overview</button>
      <button class="sub-tab" onclick="switchSubTab('valuation')">Valuation</button>
      <button class="sub-tab" onclick="switchSubTab('financial')">Financial</button>
      <button class="sub-tab" onclick="switchSubTab('performance')">Performance</button>
    </div>
    <div class="table-wrapper"><table class="data-table" id="screenerTable"><thead id="screenerHead"></thead><tbody id="screenerBody"><tr><td colspan="10" style="text-align:center;padding:40px"><div class="spinner"></div>Loading...</td></tr></tbody></table></div>
    <div class="pagination" id="screenerPagination"></div>
  </div>

  <!-- OPTION CHAIN -->
  <div id="optionchain" class="page">
    <div class="section-title">üìä Option Chain <span class="data-source">Data: Upstox</span></div>
    <div class="oc-controls">
      <select class="oc-select" id="ocUnderlying">
        <option value="NIFTY">NIFTY 50</option><option value="BANKNIFTY">BANK NIFTY</option><option value="FINNIFTY">FIN NIFTY</option>
        <optgroup label="Stocks"><option value="RELIANCE">RELIANCE</option><option value="TCS">TCS</option><option value="HDFCBANK">HDFC BANK</option><option value="INFY">INFOSYS</option><option value="ICICIBANK">ICICI BANK</option><option value="SBIN">SBI</option><option value="BHARTIARTL">BHARTI AIRTEL</option><option value="ITC">ITC</option><option value="TATAMOTORS">TATA MOTORS</option><option value="BAJFINANCE">BAJAJ FINANCE</option></optgroup>
      </select>
      <select class="oc-select" id="ocExpiry"><option>Select expiry</option></select>
      <button class="btn btn-primary" onclick="loadOptionChain()">Load</button>
      <div class="spot-display"><span class="spot-label">Spot</span><span class="spot-val" id="ocSpot">--</span></div>
    </div>
    <div class="oc-table-wrap">
      <table class="oc-table" id="ocTable">
        <thead><tr>
          <th class="call-header">OI</th><th class="call-header">Chg OI</th><th class="call-header">Vol</th><th class="call-header">IV</th><th class="call-header">Delta</th><th class="call-header">LTP</th><th class="call-header">Chg</th>
          <th class="strike-header">STRIKE</th>
          <th class="put-header">Chg</th><th class="put-header">LTP</th><th class="put-header">Delta</th><th class="put-header">IV</th><th class="put-header">Vol</th><th class="put-header">Chg OI</th><th class="put-header">OI</th>
        </tr></thead>
        <tbody id="ocBody"><tr><td colspan="15" style="text-align:center;padding:40px;color:var(--text-muted)">Select underlying and click Load</td></tr></tbody>
      </table>
    </div>
  </div>

  <!-- STOCK DETAIL -->
  <div id="stockdetail" class="page">
    <div class="back-btn" onclick="showPage(lastPage||'screener')">‚Üê Back</div>
    <div id="stockDetailContent"></div>
  </div>

  <!-- RATING TRACKER (Coming Soon) -->
  <div id="ratings" class="page">
    <div class="coming-soon">
      <div class="coming-soon-icon">üéØ</div>
      <h2>Rating Tracker</h2>
      <p>We're building a comprehensive analyst rating tracker that will assess the credibility and accuracy of credit rating agencies, brokerage houses, and AMCs using real historical data.</p>
      <p style="margin-top:16px;color:var(--text-muted);font-size:13px">Features coming: Target price accuracy tracking, agency performance scores, historical call analysis, and real-time rating alerts.</p>
    </div>
  </div>

  <!-- LEARNING HUB -->
  <div id="learning" class="page">
    <div class="section-title">üìö Learning Hub ‚Äî Quantitative Finance</div>
    <div class="learning-cats">
      <button class="cat-btn active" onclick="filterArticles('all')">All</button>
      <button class="cat-btn" onclick="filterArticles('beginner')">Beginner</button>
      <button class="cat-btn" onclick="filterArticles('intermediate')">Intermediate</button>
      <button class="cat-btn" onclick="filterArticles('advanced')">Advanced</button>
    </div>
    <div class="articles-grid" id="articlesGrid"></div>
  </div>
</div>

<script>
const API = 'https://zerohedgequant-backend.onrender.com';
let screenerData=[], filteredData=[], currentPage=1, lastPage='home', currentSubTab='overview';
let currentSort={col:'changePct',dir:'desc'};
const PAGE_SIZE=20;

// NAV
function showPage(id){if(id!=='stockdetail')lastPage=id;document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.getElementById(id).classList.add('active');const m={home:0,screener:1,optionchain:2,ratings:3,learning:4};document.querySelectorAll('.nav-link').forEach((n,i)=>{n.classList.toggle('active',m[id]===i)})}

// TIME
setInterval(()=>{const d=new Date();document.getElementById('marketTime').textContent=d.toLocaleString('en-IN',{timeZone:'Asia/Kolkata',hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:true})+' IST'},1000);

// API
async function api(path){try{const r=await fetch(API+path);return await r.json()}catch(e){console.error(path,e);return null}}

// FORMAT
function fmt(v,d=2){return v!=null?Number(v).toFixed(d):'--'}
function fmtP(v){return v!=null?'‚Çπ'+Number(v).toLocaleString('en-IN',{maximumFractionDigits:2}):'--'}
function fmtN(n){if(n==null)return'--';if(n>=10000000)return(n/10000000).toFixed(1)+'Cr';if(n>=100000)return(n/100000).toFixed(1)+'L';if(n>=1000)return(n/1000).toFixed(1)+'K';return n}
function fmtMcap(n){if(n==null)return'--';const cr=n/10000000;if(cr>=100000)return'‚Çπ'+(cr/100000).toFixed(1)+'L Cr';if(cr>=1000)return'‚Çπ'+(cr/1000).toFixed(1)+'K Cr';return'‚Çπ'+cr.toFixed(0)+' Cr'}
function chgFmt(v){if(v==null)return'--';return`<span class="${v>=0?'up':'down'}">${v>=0?'+':''}${Number(v).toFixed(2)}%</span>`}

// INDICES
async function loadIndices(){
  const r=await api('/api/indices');if(!r?.success||!r.data)return;
  const d=r.data,g=document.getElementById('indicesGrid');
  const items=[{k:'NIFTY50',l:'NIFTY 50'},{k:'BANKNIFTY',l:'BANK NIFTY'},{k:'NIFTYIT',l:'NIFTY IT'},{k:'FINNIFTY',l:'FIN NIFTY'}];
  g.innerHTML=items.map(i=>{const v=d[i.k];if(!v||!v.value)return`<div class="index-card"><div class="idx-name">${i.l}</div><div class="idx-value">--</div><div class="idx-change">--</div></div>`;const up=v.change>=0;return`<div class="index-card"><div class="idx-name">${i.l}</div><div class="idx-value">${v.value.toLocaleString('en-IN',{maximumFractionDigits:2})}</div><div class="idx-change ${up?'up':'down'}">${up?'‚ñ≤':'‚ñº'} ${v.change>=0?'+':''}${fmt(v.change)} (${v.changePct>=0?'+':''}${fmt(v.changePct)}%)</div></div>`}).join('');
  updateTicker(d);
  const live=Object.values(d).some(v=>v&&v.value>0);
  document.getElementById('liveStatus').textContent=live?'LIVE':'Offline';
  document.getElementById('liveBadge').querySelector('.live-dot').style.background=live?'var(--green)':'var(--red)';
}

function updateTicker(indices){
  const items=[];const names={NIFTY50:'NIFTY 50',BANKNIFTY:'BANK NIFTY',NIFTYIT:'NIFTY IT',FINNIFTY:'FIN NIFTY'};
  for(const[k,v]of Object.entries(indices)){if(!v||!v.value)continue;const up=v.change>=0;items.push(`<span class="ticker-item"><span class="ticker-name">${names[k]||k}</span><span class="ticker-value">${v.value.toLocaleString('en-IN',{maximumFractionDigits:2})}</span><span class="ticker-change ${up?'up':'down'}">${up?'+':''}${fmt(v.changePct)}%</span></span>`)}
  if(screenerData.length){[...screenerData].filter(s=>s.price>0).sort((a,b)=>Math.abs(b.changePct)-Math.abs(a.changePct)).slice(0,8).forEach(s=>{const up=s.changePct>=0;items.push(`<span class="ticker-item"><span class="ticker-name">${s.symbol}</span><span class="ticker-value">${fmtP(s.price)}</span><span class="ticker-change ${up?'up':'down'}">${up?'+':''}${fmt(s.changePct)}%</span></span>`)})}
  if(items.length)document.getElementById('tickerContent').innerHTML=items.join('')+items.join('');
}

// MOVERS
async function loadMovers(){
  const r=await api('/api/market-data');if(!r?.success||!r.data)return;
  const stocks=Object.values(r.data).filter(s=>s.price>0);
  const gainers=[...stocks].sort((a,b)=>b.changePct-a.changePct).slice(0,5);
  const losers=[...stocks].sort((a,b)=>a.changePct-b.changePct).slice(0,5);
  document.getElementById('topGainers').innerHTML=gainers.map(s=>`<div class="mover-row" onclick="showStock('${s.symbol}')"><span class="mover-symbol">${s.symbol}</span><span class="mover-price">${fmtP(s.price)}</span><span class="mover-change up">+${fmt(s.changePct)}%</span></div>`).join('')||'<div class="mover-row"><span style="color:var(--text-muted)">No data</span></div>';
  document.getElementById('topLosers').innerHTML=losers.map(s=>`<div class="mover-row" onclick="showStock('${s.symbol}')"><span class="mover-symbol">${s.symbol}</span><span class="mover-price">${fmtP(s.price)}</span><span class="mover-change down">${fmt(s.changePct)}%</span></div>`).join('')||'<div class="mover-row"><span style="color:var(--text-muted)">No data</span></div>';
}

// SEARCH
const searchInput=document.getElementById('searchInput'),searchResults=document.getElementById('searchResults');
let sTo;
searchInput.addEventListener('input',()=>{clearTimeout(sTo);const q=searchInput.value.trim();if(!q){searchResults.classList.remove('show');return}sTo=setTimeout(async()=>{const r=await api(`/api/search?q=${encodeURIComponent(q)}`);if(!r?.success||!r.data.length){searchResults.classList.remove('show');return}searchResults.innerHTML=r.data.map(s=>`<div class="search-result-item" onclick="showStock('${s.symbol}')"><div><span class="sr-symbol">${s.symbol}</span> <span class="sr-name">${s.name}</span></div><span class="sr-sector">${s.sector}</span></div>`).join('');searchResults.classList.add('show')},250)});
searchInput.addEventListener('blur',()=>setTimeout(()=>searchResults.classList.remove('show'),200));

// SCREENER
async function loadScreener(){
  const r=await api('/api/screener');if(!r?.success||!r.data)return;
  screenerData=r.data;filteredData=[...screenerData];currentPage=1;
  const sectors=[...new Set(screenerData.map(s=>s.sector).filter(Boolean))].sort();
  const industries=[...new Set(screenerData.map(s=>s.industry).filter(Boolean))].sort();
  document.getElementById('f-sector').innerHTML='<option value="">Sector</option>'+sectors.map(s=>`<option>${s}</option>`).join('');
  document.getElementById('f-industry').innerHTML='<option value="">Industry</option>'+industries.map(i=>`<option>${i}</option>`).join('');
  renderTable();
}

function switchScreenerTab(t){document.querySelectorAll('.scr-tab').forEach(x=>x.classList.remove('active'));event.target.classList.add('active');document.querySelectorAll('.filter-panel').forEach(p=>p.classList.remove('active'));document.getElementById('filter-'+t).classList.add('active')}
function switchSubTab(t){currentSubTab=t;document.querySelectorAll('.sub-tab').forEach(x=>x.classList.remove('active'));event.target.classList.add('active');renderTable()}

function v(id){const el=document.getElementById(id);return el?el.value:''}

function applyFilters(){
  filteredData=screenerData.filter(s=>{
    if(v('f-sector')&&s.sector!==v('f-sector'))return false;
    if(v('f-industry')&&s.industry!==v('f-industry'))return false;
    if(v('f-analyst')&&s.analystRec!==v('f-analyst'))return false;
    const p=s.price||0,c=s.changePct||0;
    const pf=v('f-price');
    if(pf==='Under ‚Çπ100'&&p>=100)return false;if(pf==='‚Çπ100-500'&&(p<100||p>=500))return false;if(pf==='‚Çπ500-2000'&&(p<500||p>=2000))return false;if(pf==='‚Çπ2000-5000'&&(p<2000||p>=5000))return false;if(pf==='Over ‚Çπ5000'&&p<5000)return false;
    const cf=v('f-change');if(cf==='Up >5%'&&c<=5)return false;if(cf==='Up >2%'&&c<=2)return false;if(cf==='Up'&&c<=0)return false;if(cf==='Down'&&c>=0)return false;if(cf==='Down >2%'&&c>=-2)return false;if(cf==='Down >5%'&&c>=-5)return false;
    // Fundamental filters (only apply if data exists)
    if(v('f-pe')&&s.pe!=null){const pe=s.pe;const pef=v('f-pe');if(pef==='Under 10'&&pe>=10)return false;if(pef==='Under 15'&&pe>=15)return false;if(pef==='Under 20'&&pe>=20)return false;if(pef==='Under 30'&&pe>=30)return false;if(pef==='Over 30'&&pe<30)return false}
    if(v('f-pb')&&s.pb!=null){const pb=s.pb;const pbf=v('f-pb');if(pbf==='Under 1'&&pb>=1)return false;if(pbf==='Under 2'&&pb>=2)return false;if(pbf==='Under 3'&&pb>=3)return false;if(pbf==='Over 5'&&pb<5)return false}
    if(v('f-roe')&&s.roe!=null){const roe=s.roe;const rf=v('f-roe');if(rf==='Over 30%'&&roe<30)return false;if(rf==='Over 20%'&&roe<20)return false;if(rf==='Over 15%'&&roe<15)return false;if(rf==='Under 10%'&&roe>=10)return false}
    if(v('f-de')&&s.debtEquity!=null){const de=s.debtEquity;const df=v('f-de');if(df==='Under 0.5'&&de>=0.5)return false;if(df==='Under 1'&&de>=1)return false;if(df==='Under 2'&&de>=2)return false;if(df==='Over 2'&&de<2)return false}
    if(v('f-nm')&&s.netMargin!=null){const nm=s.netMargin;const nf=v('f-nm');if(nf==='Over 20%'&&nm<20)return false;if(nf==='Over 10%'&&nm<10)return false;if(nf==='Under 10%'&&nm>=10)return false}
    if(v('f-sma50')&&s.sma50!=null&&s.price>0){if(v('f-sma50')==='Above SMA50'&&s.price<=s.sma50)return false;if(v('f-sma50')==='Below SMA50'&&s.price>=s.sma50)return false}
    if(v('f-sma200')&&s.sma200!=null&&s.price>0){if(v('f-sma200')==='Above SMA200'&&s.price<=s.sma200)return false;if(v('f-sma200')==='Below SMA200'&&s.price>=s.sma200)return false}
    if(v('f-beta')&&s.beta!=null){if(v('f-beta')==='Over 1.5'&&s.beta<=1.5)return false;if(v('f-beta')==='Over 1'&&s.beta<=1)return false;if(v('f-beta')==='Under 1'&&s.beta>=1)return false}
    return true;
  });
  currentPage=1;renderTable();
}

function resetFilters(){document.querySelectorAll('.filter-select').forEach(s=>s.selectedIndex=0);filteredData=[...screenerData];currentPage=1;renderTable()}

function getColumns(){
  const base=[{key:'symbol',label:'Ticker',fmt:(v,s)=>`<span class="stock-link" onclick="showStock('${s.symbol}')">${v}</span>`},{key:'name',label:'Company'}];
  return{
    overview:[...base,{key:'sector',label:'Sector'},{key:'price',label:'Price',fmt:v=>fmtP(v)},{key:'changePct',label:'Change',fmt:chgFmt},{key:'volume',label:'Volume',fmt:v=>fmtN(v)},{key:'marketCap',label:'Mkt Cap',fmt:v=>fmtMcap(v)},{key:'pe',label:'P/E',fmt:v=>fmt(v,1)},{key:'dividend',label:'Div %',fmt:v=>fmt(v,1)}],
    valuation:[...base,{key:'price',label:'Price',fmt:v=>fmtP(v)},{key:'pe',label:'P/E',fmt:v=>fmt(v,1)},{key:'fwdPe',label:'Fwd P/E',fmt:v=>fmt(v,1)},{key:'peg',label:'PEG',fmt:v=>fmt(v,2)},{key:'pb',label:'P/B',fmt:v=>fmt(v,1)},{key:'evEbitda',label:'EV/EBITDA',fmt:v=>fmt(v,1)},{key:'eps',label:'EPS',fmt:v=>fmt(v,1)},{key:'marketCap',label:'Mkt Cap',fmt:v=>fmtMcap(v)}],
    financial:[...base,{key:'price',label:'Price',fmt:v=>fmtP(v)},{key:'roe',label:'ROE %',fmt:v=>fmt(v,1)},{key:'roa',label:'ROA %',fmt:v=>fmt(v,1)},{key:'debtEquity',label:'D/E',fmt:v=>fmt(v,2)},{key:'grossMargin',label:'Gross M%',fmt:v=>fmt(v,1)},{key:'operatingMargin',label:'Oper M%',fmt:v=>fmt(v,1)},{key:'netMargin',label:'Net M%',fmt:v=>fmt(v,1)},{key:'revenueGrowth',label:'Rev G%',fmt:v=>fmt(v,1)},{key:'earningsGrowth',label:'Earn G%',fmt:v=>fmt(v,1)}],
    performance:[...base,{key:'price',label:'Price',fmt:v=>fmtP(v)},{key:'changePct',label:'Today',fmt:chgFmt},{key:'volume',label:'Volume',fmt:v=>fmtN(v)},{key:'high52w',label:'52W High',fmt:v=>fmtP(v)},{key:'low52w',label:'52W Low',fmt:v=>fmtP(v)},{key:'sma50',label:'SMA50',fmt:v=>fmtP(v)},{key:'sma200',label:'SMA200',fmt:v=>fmtP(v)},{key:'beta',label:'Beta',fmt:v=>fmt(v,2)}],
  }[currentSubTab]||[];
}

function renderTable(){
  const cols=getColumns();
  const sorted=[...filteredData].sort((a,b)=>{const av=a[currentSort.col]??-Infinity,bv=b[currentSort.col]??-Infinity;if(typeof av==='string')return currentSort.dir==='asc'?av.localeCompare(bv):bv.localeCompare(av);return currentSort.dir==='asc'?av-bv:bv-av});
  const total=Math.ceil(sorted.length/PAGE_SIZE),start=(currentPage-1)*PAGE_SIZE,page=sorted.slice(start,start+PAGE_SIZE);
  document.getElementById('screenerHead').innerHTML='<tr>'+cols.map(c=>`<th class="${currentSort.col===c.key?'sorted':''}" onclick="sortCol('${c.key}')">${c.label}${currentSort.col===c.key?(currentSort.dir==='asc'?' ‚ñ≤':' ‚ñº'):''}</th>`).join('')+'</tr>';
  document.getElementById('screenerBody').innerHTML=page.length?page.map(s=>'<tr>'+cols.map(c=>`<td>${c.fmt?c.fmt(s[c.key],s):(s[c.key]!=null?s[c.key]:'--')}</td>`).join('')+'</tr>').join(''):'<tr><td colspan="'+cols.length+'" style="text-align:center;padding:30px;color:var(--text-muted)">No stocks match filters</td></tr>';
  document.getElementById('screenerPagination').innerHTML=`<span>Showing ${start+1}-${Math.min(start+PAGE_SIZE,sorted.length)} of ${sorted.length}</span><div class="page-btns"><button class="page-btn" ${currentPage<=1?'disabled':''} onclick="goPage(${currentPage-1})">‚Äπ</button>${Array.from({length:Math.min(total,7)},(_,i)=>{const p=total<=7?i+1:Math.max(1,Math.min(currentPage-3,total-6))+i;if(p>total)return'';return`<button class="page-btn ${p===currentPage?'active':''}" onclick="goPage(${p})">${p}</button>`}).join('')}<button class="page-btn" ${currentPage>=total?'disabled':''} onclick="goPage(${currentPage+1})">‚Ä∫</button></div>`;
  ['filterCount','filterCount2','filterCount3'].forEach(id=>{const el=document.getElementById(id);if(el)el.textContent=filteredData.length+' stocks'});
}
function sortCol(c){if(currentSort.col===c)currentSort.dir=currentSort.dir==='asc'?'desc':'asc';else{currentSort.col=c;currentSort.dir='desc'}renderTable()}
function goPage(p){currentPage=p;renderTable()}

// OPTION CHAIN
async function loadOptionChain(){
  const ul=document.getElementById('ocUnderlying').value,exp=document.getElementById('ocExpiry').value;
  const body=document.getElementById('ocBody');
  body.innerHTML='<tr><td colspan="15" style="text-align:center;padding:40px"><div class="spinner"></div>Loading...</td></tr>';
  const r=await api(`/api/option-chain/${ul}?expiry=${exp}`);
  if(!r?.success||!r.data){body.innerHTML=`<tr><td colspan="15" style="text-align:center;padding:40px;color:var(--red)">${r?.error||'Failed to load'}</td></tr>`;return}
  const d=r.data;
  document.getElementById('ocSpot').textContent=d.spot_price?d.spot_price.toLocaleString('en-IN',{maximumFractionDigits:2}):'--';
  if(d.expiries?.length)document.getElementById('ocExpiry').innerHTML=d.expiries.map(e=>`<option value="${e}" ${e===d.expiry?'selected':''}>${new Date(e+'T00:00:00').toLocaleDateString('en-IN',{day:'numeric',month:'short',year:'numeric'})}</option>`).join('');
  const spot=d.spot_price||0;
  body.innerHTML=(d.strikes||[]).map(s=>{
    const atm=spot&&Math.abs(s.strike_price-spot)<(spot>10000?60:30);
    const cITM=spot&&s.strike_price<spot,pITM=spot&&s.strike_price>spot;
    const c=s.call||{},p=s.put||{};
    return`<tr>
      <td class="call-cell ${cITM?'itm-call':''} ${atm?'atm':''}">${fmtN(c.oi)}</td>
      <td class="call-cell ${cITM?'itm-call':''} ${atm?'atm':''}">${fmtN(c.oi_change)}</td>
      <td class="call-cell ${cITM?'itm-call':''} ${atm?'atm':''}">${fmtN(c.volume)}</td>
      <td class="call-cell ${cITM?'itm-call':''} ${atm?'atm':''}">${c.iv!=null?fmt(c.iv,1):'--'}</td>
      <td class="call-cell ${cITM?'itm-call':''} ${atm?'atm':''}">${c.delta!=null?fmt(c.delta,3):'--'}</td>
      <td class="call-cell ${cITM?'itm-call':''} ${atm?'atm':''}" style="font-weight:600">${fmt(c.ltp)}</td>
      <td class="call-cell ${cITM?'itm-call':''} ${atm?'atm':''} ${(c.change||0)>=0?'up':'down'}">${fmt(c.change)}</td>
      <td class="strike-cell ${atm?'atm':''}">${s.strike_price}</td>
      <td class="put-cell ${pITM?'itm-put':''} ${atm?'atm':''} ${(p.change||0)>=0?'up':'down'}">${fmt(p.change)}</td>
      <td class="put-cell ${pITM?'itm-put':''} ${atm?'atm':''}" style="font-weight:600">${fmt(p.ltp)}</td>
      <td class="put-cell ${pITM?'itm-put':''} ${atm?'atm':''}">${p.delta!=null?fmt(p.delta,3):'--'}</td>
      <td class="put-cell ${pITM?'itm-put':''} ${atm?'atm':''}">${p.iv!=null?fmt(p.iv,1):'--'}</td>
      <td class="put-cell ${pITM?'itm-put':''} ${atm?'atm':''}">${fmtN(p.volume)}</td>
      <td class="put-cell ${pITM?'itm-put':''} ${atm?'atm':''}">${fmtN(p.oi_change)}</td>
      <td class="put-cell ${pITM?'itm-put':''} ${atm?'atm':''}">${fmtN(p.oi)}</td>
    </tr>`}).join('');
}

// STOCK DETAIL
async function showStock(sym){
  showPage('stockdetail');
  const c=document.getElementById('stockDetailContent');
  c.innerHTML='<div style="text-align:center;padding:60px"><div class="spinner"></div>Loading...</div>';
  const r=await api(`/api/stock/${sym}`);
  if(!r?.success||!r.data){c.innerHTML='<div style="color:var(--red);padding:40px">Failed to load</div>';return}
  const s=r.data,up=(s.changePct||0)>=0,f=s.fundamentals||{};
  c.innerHTML=`
    <div class="stock-header">
      <div class="stock-title-area">
        <h2>${s.symbol} <span class="stock-tag">${s.sector}</span> <span class="stock-tag">${s.industry}</span></h2>
        <div style="color:var(--text-secondary);font-size:14px;margin-top:4px">${s.name}</div>
        <div class="data-source">Price: Upstox${f.pe?' | Fundamentals: Yahoo Finance':''}</div>
      </div>
      <div class="stock-price-area">
        <div class="stock-price">${fmtP(s.price)}</div>
        <div class="stock-change-line ${up?'up':'down'}">${up?'‚ñ≤':'‚ñº'} ${fmt(s.change)} (${up?'+':''}${fmt(s.changePct)}%)</div>
      </div>
    </div>
    <div class="section-title">Price Data</div>
    <div class="stock-stats-grid">
      <div class="stat-box"><div class="stat-label">Open</div><div class="stat-value">${fmtP(s.open)}</div></div>
      <div class="stat-box"><div class="stat-label">High</div><div class="stat-value">${fmtP(s.high)}</div></div>
      <div class="stat-box"><div class="stat-label">Low</div><div class="stat-value">${fmtP(s.low)}</div></div>
      <div class="stat-box"><div class="stat-label">Prev Close</div><div class="stat-value">${fmtP(s.prevClose)}</div></div>
      <div class="stat-box"><div class="stat-label">Volume</div><div class="stat-value">${fmtN(s.volume)}</div></div>
      <div class="stat-box"><div class="stat-label">Avg Price</div><div class="stat-value">${fmtP(s.avgPrice)}</div></div>
      <div class="stat-box"><div class="stat-label">Upper Circuit</div><div class="stat-value">${fmtP(s.upperCircuit)}</div></div>
      <div class="stat-box"><div class="stat-label">Lower Circuit</div><div class="stat-value">${fmtP(s.lowerCircuit)}</div></div>
    </div>
    ${f.pe!=null?`
    <div class="section-title">Fundamentals <span class="data-source">Source: Yahoo Finance</span></div>
    <div class="stock-stats-grid">
      <div class="stat-box"><div class="stat-label">P/E (TTM)</div><div class="stat-value">${fmt(f.pe,1)}</div></div>
      <div class="stat-box"><div class="stat-label">Forward P/E</div><div class="stat-value">${fmt(f.fwdPe,1)}</div></div>
      <div class="stat-box"><div class="stat-label">P/B</div><div class="stat-value">${fmt(f.pb,1)}</div></div>
      <div class="stat-box"><div class="stat-label">EV/EBITDA</div><div class="stat-value">${fmt(f.evEbitda,1)}</div></div>
      <div class="stat-box"><div class="stat-label">EPS</div><div class="stat-value">‚Çπ${fmt(f.eps,1)}</div></div>
      <div class="stat-box"><div class="stat-label">Mkt Cap</div><div class="stat-value">${fmtMcap(f.marketCap)}</div></div>
      <div class="stat-box"><div class="stat-label">Dividend Yield</div><div class="stat-value">${fmt(f.dividend,2)}%</div></div>
      <div class="stat-box"><div class="stat-label">Target Price</div><div class="stat-value">${fmtP(f.targetPrice)}</div></div>
    </div>
    <div class="section-title">Profitability & Risk</div>
    <div class="stock-stats-grid">
      <div class="stat-box"><div class="stat-label">ROE</div><div class="stat-value">${fmt(f.roe,1)}%</div></div>
      <div class="stat-box"><div class="stat-label">ROA</div><div class="stat-value">${fmt(f.roa,1)}%</div></div>
      <div class="stat-box"><div class="stat-label">Gross Margin</div><div class="stat-value">${fmt(f.grossMargin,1)}%</div></div>
      <div class="stat-box"><div class="stat-label">Operating Margin</div><div class="stat-value">${fmt(f.operatingMargin,1)}%</div></div>
      <div class="stat-box"><div class="stat-label">Net Margin</div><div class="stat-value">${fmt(f.netMargin,1)}%</div></div>
      <div class="stat-box"><div class="stat-label">Debt/Equity</div><div class="stat-value">${fmt(f.debtEquity,2)}</div></div>
      <div class="stat-box"><div class="stat-label">Beta</div><div class="stat-value">${fmt(f.beta,2)}</div></div>
      <div class="stat-box"><div class="stat-label">Analyst Rec.</div><div class="stat-value">${f.analystRec||'--'} (${f.numAnalysts||0})</div></div>
    </div>
    <div class="section-title">52 Week Range</div>
    <div class="stock-stats-grid">
      <div class="stat-box"><div class="stat-label">52W High</div><div class="stat-value">${fmtP(f.high52w)}</div></div>
      <div class="stat-box"><div class="stat-label">52W Low</div><div class="stat-value">${fmtP(f.low52w)}</div></div>
      <div class="stat-box"><div class="stat-label">SMA 50</div><div class="stat-value">${fmtP(f.sma50)}</div></div>
      <div class="stat-box"><div class="stat-label">SMA 200</div><div class="stat-value">${fmtP(f.sma200)}</div></div>
      <div class="stat-box"><div class="stat-label">Revenue Growth</div><div class="stat-value">${fmt(f.revenueGrowth,1)}%</div></div>
      <div class="stat-box"><div class="stat-label">Earnings Growth</div><div class="stat-value">${fmt(f.earningsGrowth,1)}%</div></div>
    </div>
    `:'<div style="color:var(--text-muted);padding:20px;font-size:13px;background:var(--bg-card);border:1px solid var(--border);border-radius:8px;margin-top:16px">‚è≥ Fundamental data loading from Yahoo Finance... Refresh in a moment.</div>'}`;
}

// LEARNING HUB
const articles=[
  {title:'What is a Stock?',desc:'Understanding equities, shares, and ownership in companies.',level:'beginner',time:'5 min',cat:'Basics'},
  {title:'Reading Financial Statements',desc:'How to interpret Balance Sheets, P&L Statements, and Cash Flow statements.',level:'beginner',time:'12 min',cat:'Fundamentals'},
  {title:'P/E Ratio Deep Dive',desc:'Why Price-to-Earnings ratio matters, its limitations, and sector comparisons.',level:'beginner',time:'8 min',cat:'Valuation'},
  {title:'Introduction to Technical Analysis',desc:'Chart patterns, support/resistance, and price action basics.',level:'beginner',time:'10 min',cat:'Technical'},
  {title:'Understanding Options',desc:'Calls, puts, strike prices, and expiry ‚Äî complete foundation for derivatives.',level:'intermediate',time:'15 min',cat:'Derivatives'},
  {title:'Option Greeks Explained',desc:'Delta, Gamma, Theta, Vega ‚Äî what they mean for your P&L.',level:'intermediate',time:'18 min',cat:'Derivatives'},
  {title:'DCF Valuation Model',desc:'Building a Discounted Cash Flow model with real company examples.',level:'intermediate',time:'20 min',cat:'Valuation'},
  {title:'Risk Management Frameworks',desc:'Position sizing, stop losses, Kelly Criterion, and drawdown management.',level:'intermediate',time:'14 min',cat:'Risk'},
  {title:'Black-Scholes Model',desc:'The mathematics behind option pricing and its assumptions.',level:'advanced',time:'25 min',cat:'Quant'},
  {title:'Monte Carlo Simulations',desc:'Random sampling for portfolio returns, VaR, and stress testing.',level:'advanced',time:'22 min',cat:'Quant'},
  {title:'Factor Investing & Smart Beta',desc:'Momentum, Value, Quality factors ‚Äî building systematic strategies.',level:'advanced',time:'20 min',cat:'Quant'},
  {title:'Stochastic Calculus for Finance',desc:'Brownian motion, Ito\'s lemma, and mathematical foundations.',level:'advanced',time:'30 min',cat:'Quant'},
];

function renderArticles(f='all'){
  document.getElementById('articlesGrid').innerHTML=(f==='all'?articles:articles.filter(a=>a.level===f)).map(a=>`<div class="article-card"><span class="article-level level-${a.level}">${a.level}</span><div class="article-title">${a.title}</div><div class="article-desc">${a.desc}</div><div class="article-meta"><span>üìñ ${a.time}</span><span>üìÇ ${a.cat}</span></div></div>`).join('');
}
function filterArticles(l){document.querySelectorAll('.cat-btn').forEach(b=>b.classList.remove('active'));event.target.classList.add('active');renderArticles(l)}

// INIT
async function init(){
  await Promise.all([loadIndices(),loadMovers(),loadScreener()]);
  renderArticles();
  setInterval(async()=>{await loadIndices();await loadMovers()},30000);
  setInterval(loadScreener,60000);
}
init();
</script>
</body>
</html>
