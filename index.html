<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZerohedgeQuant - Live Market Data</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=Syne:wght@400;700;800&display=swap" rel="stylesheet">
<style>
:root {
  --bg-deep: #0a0c0f;
  --bg-card: #111418;
  --bg-card-hover: #161b22;
  --border: #1e252e;
  --text-primary: #e8eaed;
  --text-secondary: #8b949e;
  --text-muted: #484f58;
  --accent: #00d4aa;
  --accent-dim: rgba(0,212,170,0.12);
  --accent2: #e6a817;
  --red: #f85149;
  --green: #3fb950;
  --blue: #58a6ff;
  --purple: #bc8cff;
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: 'IBM Plex Mono', monospace;
  background: var(--bg-deep);
  color: var(--text-primary);
  min-height: 100vh;
  overflow-x: hidden;
}
body::before {
  content: '';
  position: fixed; inset: 0;
  background: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");
  pointer-events: none; z-index: 999; opacity: .4;
}
nav {
  position: sticky; top: 0; z-index: 100;
  background: rgba(10,12,15,0.85);
  backdrop-filter: blur(14px);
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 32px; height: 62px;
}
.logo { font-family: 'Syne', sans-serif; font-weight: 800; font-size: 1.25rem; letter-spacing: -0.5px; }
.logo span { color: var(--accent); }
.nav-links { display: flex; gap: 6px; }
.nav-links button {
  background: none; border: none; color: var(--text-secondary);
  font-family: 'IBM Plex Mono', monospace; font-size: .82rem;
  padding: 7px 14px; border-radius: 6px; cursor: pointer;
  transition: all .2s;
}
.nav-links button:hover, .nav-links button.active {
  background: var(--accent-dim); color: var(--accent);
}
.nav-live {
  display: flex; align-items: center; gap: 10px;
  font-size: .75rem; color: var(--text-muted);
}
.dot-live { width: 7px; height: 7px; border-radius: 50%; background: var(--green); animation: pulse 2s infinite; }
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.4} }
.section { display: none; padding: 32px; max-width: 1400px; margin: 0 auto; animation: fadeIn .35s ease; }
.section.active { display: block; }
@keyframes fadeIn { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:translateY(0)} }
.hero {
  position: relative; border-radius: 16px; overflow: hidden;
  background: linear-gradient(135deg, #0d1117 0%, #111820 50%, #0a0e14 100%);
  border: 1px solid var(--border);
  padding: 60px 48px; margin-bottom: 36px; text-align: center;
}
.hero::before {
  content:''; position:absolute; inset:0;
  background: radial-gradient(ellipse 80% 60% at 50% 0%, rgba(0,212,170,.08) 0%, transparent 70%);
  pointer-events:none;
}
.hero h1 { font-family:'Syne',sans-serif; font-size:2.5rem; font-weight:800; letter-spacing:-1.5px; position:relative; }
.hero h1 span { color: var(--accent); }
.hero p { color: var(--text-secondary); margin-top:14px; font-size:.88rem; max-width:520px; margin-left:auto; margin-right:auto; line-height:1.6; position:relative; }
.stat-row { display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:14px; margin-bottom:32px; }
.stat-card {
  background: var(--bg-card); border: 1px solid var(--border); border-radius:10px;
  padding: 16px 18px; transition:.2s;
}
.stat-card:hover { border-color: var(--accent); background: var(--bg-card-hover); }
.stat-label { font-size:.7rem; color:var(--text-muted); text-transform:uppercase; letter-spacing:.8px; }
.stat-value { font-size:1.35rem; font-weight:600; margin-top:4px; }
.stat-change { font-size:.7rem; margin-top:4px; }
.up { color:var(--green); } .down { color:var(--red); }
.sec-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:20px; margin-top:36px; }
.sec-header h2 { font-family:'Syne',sans-serif; font-size:1.2rem; font-weight:700; }
.sec-header .tag { font-size:.68rem; background:var(--accent-dim); color:var(--accent); padding:3px 10px; border-radius:12px; }
.mini-table-wrap { overflow-x:auto; border-radius:10px; border:1px solid var(--border); margin-bottom:28px; }
.mini-table { width:100%; border-collapse:collapse; font-size:.78rem; }
.mini-table thead { background:rgba(17,20,24,.9); }
.mini-table th { text-align:left; padding:10px 12px; color:var(--text-muted); font-weight:600; text-transform:uppercase; letter-spacing:.5px; font-size:.68rem; border-bottom:1px solid var(--border); white-space:nowrap; }
.mini-table td { padding:10px 12px; border-bottom:1px solid var(--border); color:var(--text-secondary); white-space:nowrap; }
.mini-table tr:last-child td { border-bottom:none; }
.mini-table tr:hover td { background:var(--bg-card-hover); }
.stock-name { color:var(--text-primary); font-weight:600; font-size:.82rem; }
.sector-badge { font-size:.66rem; background:rgba(88,166,255,.1); color:var(--blue); padding:2px 7px; border-radius:4px; }
.loading { text-align:center; padding:30px; color:var(--text-muted); font-size:.8rem; }
.filter-bar { 
  display:flex; gap:10px; flex-wrap:wrap; margin-bottom:22px; align-items:center;
  background:var(--bg-card); padding:16px; border-radius:10px; border:1px solid var(--border);
}
.filter-bar select {
  background:var(--bg-deep); border:1px solid var(--border); color:var(--text-primary);
  padding:8px 12px; border-radius:6px; font-family:inherit; font-size:.78rem;
  outline:none; transition:.2s; min-width:140px;
}
.filter-bar select:focus { border-color:var(--accent); }
.filter-label { font-size:.7rem; color:var(--text-muted); font-weight:600; text-transform:uppercase; letter-spacing:.5px; }
.sparkline { display:inline-block; }
</style>
</head>
<body>

<nav>
  <div class="logo">Zeroh<span>edge</span>Quant</div>
  <div class="nav-links">
    <button class="active" onclick="showSection('home')">Home</button>
    <button onclick="showSection('market')">Market Analysis</button>
    <button onclick="showSection('screener')">Screener</button>
  </div>
  <div class="nav-live"><div class="dot-live"></div> LIVE via Upstox</div>
</nav>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HOME ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="home" class="section active">
  <div class="hero">
    <h1>Master the <span>Quant Edge</span></h1>
    <p>Real-time Indian market data ‚Ä¢ Top movers ‚Ä¢ Advanced analytics</p>
  </div>

  <div class="stat-row" id="index-stats">
    <div class="loading">Loading indices...</div>
  </div>

  <div class="sec-header"><h2>üî• Top Gainers</h2><span class="tag">Top 10</span></div>
  <div class="mini-table-wrap">
    <table class="mini-table">
      <thead><tr><th>#</th><th>Stock</th><th>Sector</th><th>Price ‚Çπ</th><th>Change %</th></tr></thead>
      <tbody id="top-gainers-table"><tr><td colspan="5" class="loading">Loading...</td></tr></tbody>
    </table>
  </div>

  <div class="sec-header"><h2>üìâ Top Losers</h2><span class="tag">Top 10</span></div>
  <div class="mini-table-wrap">
    <table class="mini-table">
      <thead><tr><th>#</th><th>Stock</th><th>Sector</th><th>Price ‚Çπ</th><th>Change %</th></tr></thead>
      <tbody id="top-losers-table"><tr><td colspan="5" class="loading">Loading...</td></tr></tbody>
    </table>
  </div>

  <div class="sec-header"><h2>üìä Most Active</h2><span class="tag">By Volume</span></div>
  <div class="mini-table-wrap">
    <table class="mini-table">
      <thead><tr><th>#</th><th>Stock</th><th>Sector</th><th>Price ‚Çπ</th><th>Volume</th></tr></thead>
      <tbody id="most-active-table"><tr><td colspan="5" class="loading">Loading...</td></tr></tbody>
    </table>
  </div>

  <div class="sec-header"><h2>‚¨ÜÔ∏è Near 52-Week High</h2><span class="tag">Top 10</span></div>
  <div class="mini-table-wrap">
    <table class="mini-table">
      <thead><tr><th>#</th><th>Stock</th><th>Price ‚Çπ</th><th>52W High ‚Çπ</th><th>Away from High</th></tr></thead>
      <tbody id="52w-high-table"><tr><td colspan="5" class="loading">Loading...</td></tr></tbody>
    </table>
  </div>

  <div class="sec-header"><h2>‚¨áÔ∏è Near 52-Week Low</h2><span class="tag">Top 10</span></div>
  <div class="mini-table-wrap">
    <table class="mini-table">
      <thead><tr><th>#</th><th>Stock</th><th>Price ‚Çπ</th><th>52W Low ‚Çπ</th><th>Away from Low</th></tr></thead>
      <tbody id="52w-low-table"><tr><td colspan="5" class="loading">Loading...</td></tr></tbody>
    </table>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MARKET ANALYSIS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="market" class="section">
  <div class="sec-header"><h2>Market Analysis</h2><span class="tag">Live Data</span></div>

  <div class="filter-bar">
    <span class="filter-label">Sector:</span>
    <select id="market-sector-filter" onchange="applyMarketFilters()">
      <option value="all">All Sectors</option>
      <option value="IT">IT</option>
      <option value="Banking">Banking</option>
      <option value="FMCG">FMCG</option>
      <option value="Pharma">Pharma</option>
      <option value="Auto">Auto</option>
      <option value="Realty">Realty</option>
      <option value="Energy">Energy</option>
    </select>
    
    <span class="filter-label">Sort By:</span>
    <select id="market-sort-filter" onchange="applyMarketFilters()">
      <option value="change">% Change</option>
      <option value="volume">Volume</option>
      <option value="price">Price</option>
      <option value="name">Name</option>
    </select>
  </div>

  <div class="mini-table-wrap">
    <table class="mini-table">
      <thead>
        <tr><th>#</th><th>Stock</th><th>Sector</th><th>Price ‚Çπ</th><th>Change</th><th>% Change</th><th>Volume</th><th>Mkt Cap (Cr)</th></tr>
      </thead>
      <tbody id="market-table"><tr><td colspan="8" class="loading">Loading market data...</td></tr></tbody>
    </table>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SCREENER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="screener" class="section">
  <div class="sec-header"><h2>Advanced Stock Screener</h2><span class="tag">Multi-Filter</span></div>

  <div class="filter-bar">
    <span class="filter-label">Sector:</span>
    <select id="screener-sector-filter" onchange="applyScreenerFilters()">
      <option value="all">All</option>
      <option value="IT">IT</option>
      <option value="Banking">Banking</option>
      <option value="FMCG">FMCG</option>
      <option value="Pharma">Pharma</option>
      <option value="Auto">Auto</option>
      <option value="Realty">Realty</option>
      <option value="Energy">Energy</option>
    </select>
    
    <span class="filter-label">P/E Ratio:</span>
    <select id="screener-pe-filter" onchange="applyScreenerFilters()">
      <option value="all">All</option>
      <option value="0-15">< 15</option>
      <option value="15-30">15-30</option>
      <option value="30-50">30-50</option>
      <option value="50+">> 50</option>
    </select>
    
    <span class="filter-label">ROE:</span>
    <select id="screener-roe-filter" onchange="applyScreenerFilters()">
      <option value="all">All</option>
      <option value="20+">> 20%</option>
      <option value="15+">> 15%</option>
      <option value="10+">> 10%</option>
    </select>
  </div>

  <div class="mini-table-wrap">
    <table class="mini-table">
      <thead>
        <tr><th>#</th><th>Stock</th><th>Sector</th><th>Price ‚Çπ</th><th>P/E</th><th>ROE %</th><th>Mkt Cap (Cr)</th><th>52W High</th><th>52W Low</th><th>Debt/Eq</th><th>Div Yield %</th></tr>
      </thead>
      <tbody id="screener-table"><tr><td colspan="11" class="loading">Loading screener data...</td></tr></tbody>
    </table>
  </div>
</div>

<script>
const API_URL = 'https://zerohedgequant-backend.onrender.com';

// Global data stores
let allMarketData = [];
let allScreenerData = [];

function showSection(id) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-links button').forEach(b => b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  [...document.querySelectorAll('.nav-links button')].find(b => b.textContent.toLowerCase().includes(id.slice(0,4)))?.classList.add('active');
}

function sparkSVG(data, up) {
  const w=60, h=22, pts=data.length, step=w/(pts-1);
  const max=Math.max(...data), min=Math.min(...data), range=max-min||1;
  let d = data.map((v,i) => `${i*step},${h-((v-min)/range)*h}`).join(' ');
  const color = up ? 'var(--green)' : 'var(--red)';
  return `<svg class="sparkline" width="${w}" height="${h}" viewBox="0 0 ${w} ${h}">
    <polyline fill="none" stroke="${color}" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" points="${d}"/>
    <circle cx="${(pts-1)*step}" cy="${h-((data[pts-1]-min)/range)*h}" r="2.2" fill="${color}"/>
  </svg>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FETCH FUNCTIONS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

async function fetchIndices() {
  try {
    const response = await fetch(`${API_URL}/api/indices`);
    const result = await response.json();
    
    if (result.success && result.data) {
      const { nifty, sensex, banknifty } = result.data;
      document.getElementById('index-stats').innerHTML = `
        <div class="stat-card">
          <div class="stat-label">Nifty 50</div>
          <div class="stat-value">${nifty?.value || '---'}</div>
          <div class="stat-change ${nifty?.pct >= 0 ? 'up' : 'down'}">${nifty?.pct >= 0 ? '‚ñ≤' : '‚ñº'} ${Math.abs(nifty?.pct || 0)}%</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Sensex</div>
          <div class="stat-value">${sensex?.value || '---'}</div>
          <div class="stat-change ${sensex?.pct >= 0 ? 'up' : 'down'}">${sensex?.pct >= 0 ? '‚ñ≤' : '‚ñº'} ${Math.abs(sensex?.pct || 0)}%</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Bank Nifty</div>
          <div class="stat-value">${banknifty?.value || '---'}</div>
          <div class="stat-change ${banknifty?.pct >= 0 ? 'up' : 'down'}">${banknifty?.pct >= 0 ? '‚ñ≤' : '‚ñº'} ${Math.abs(banknifty?.pct || 0)}%</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Data Source</div>
          <div class="stat-value" style="font-size:1rem;color:var(--accent)">Upstox Live</div>
          <div class="stat-change" style="color:var(--text-muted)">Real-time</div>
        </div>
      `;
    }
  } catch (error) {
    console.error('Error fetching indices:', error);
  }
}

async function fetchTopGainers() {
  try {
    const response = await fetch(`${API_URL}/api/top-gainers`);
    const result = await response.json();
    
    if (result.success && result.data) {
      const tbody = document.getElementById('top-gainers-table');
      tbody.innerHTML = result.data.map((s, i) => `
        <tr>
          <td style="color:var(--text-muted)">${i+1}</td>
          <td><span class="stock-name">${s.name}</span></td>
          <td><span class="sector-badge">${s.sector}</span></td>
          <td style="color:var(--text-primary);font-weight:600">‚Çπ${parseFloat(s.price).toLocaleString()}</td>
          <td class="up">+${s.pct}%</td>
        </tr>
      `).join('');
    }
  } catch (error) {
    console.error('Error:', error);
  }
}

async function fetchTopLosers() {
  try {
    const response = await fetch(`${API_URL}/api/top-losers`);
    const result = await response.json();
    
    if (result.success && result.data) {
      const tbody = document.getElementById('top-losers-table');
      tbody.innerHTML = result.data.map((s, i) => `
        <tr>
          <td style="color:var(--text-muted)">${i+1}</td>
          <td><span class="stock-name">${s.name}</span></td>
          <td><span class="sector-badge">${s.sector}</span></td>
          <td style="color:var(--text-primary);font-weight:600">‚Çπ${parseFloat(s.price).toLocaleString()}</td>
          <td class="down">${s.pct}%</td>
        </tr>
      `).join('');
    }
  } catch (error) {
    console.error('Error:', error);
  }
}

async function fetchMostActive() {
  try {
    const response = await fetch(`${API_URL}/api/most-active`);
    const result = await response.json();
    
    if (result.success && result.data) {
      const tbody = document.getElementById('most-active-table');
      tbody.innerHTML = result.data.map((s, i) => `
        <tr>
          <td style="color:var(--text-muted)">${i+1}</td>
          <td><span class="stock-name">${s.name}</span></td>
          <td><span class="sector-badge">${s.sector}</span></td>
          <td style="color:var(--text-primary);font-weight:600">‚Çπ${parseFloat(s.price).toLocaleString()}</td>
          <td style="color:var(--blue);font-weight:600">${s.volumeFormatted}</td>
        </tr>
      `).join('');
    }
  } catch (error) {
    console.error('Error:', error);
  }
}

async function fetch52WHighs() {
  try {
    const response = await fetch(`${API_URL}/api/52week-highs`);
    const result = await response.json();
    
    if (result.success && result.data) {
      const tbody = document.getElementById('52w-high-table');
      tbody.innerHTML = result.data.map((s, i) => `
        <tr>
          <td style="color:var(--text-muted)">${i+1}</td>
          <td><span class="stock-name">${s.name}</span></td>
          <td style="color:var(--text-primary);font-weight:600">‚Çπ${parseFloat(s.price).toLocaleString()}</td>
          <td>‚Çπ${parseFloat(s.high52w).toLocaleString()}</td>
          <td style="color:var(--accent)">${s.distanceFromHigh}%</td>
        </tr>
      `).join('');
    }
  } catch (error) {
    console.error('Error:', error);
  }
}

async function fetch52WLows() {
  try {
    const response = await fetch(`${API_URL}/api/52week-lows`);
    const result = await response.json();
    
    if (result.success && result.data) {
      const tbody = document.getElementById('52w-low-table');
      tbody.innerHTML = result.data.map((s, i) => `
        <tr>
          <td style="color:var(--text-muted)">${i+1}</td>
          <td><span class="stock-name">${s.name}</span></td>
          <td style="color:var(--text-primary);font-weight:600">‚Çπ${parseFloat(s.price).toLocaleString()}</td>
          <td>‚Çπ${parseFloat(s.low52w).toLocaleString()}</td>
          <td style="color:var(--red)">${s.distanceFromLow}%</td>
        </tr>
      `).join('');
    }
  } catch (error) {
    console.error('Error:', error);
  }
}

async function fetchMarketData() {
  try {
    const response = await fetch(`${API_URL}/api/market-data`);
    const result = await response.json();
    
    if (result.success && result.data) {
      allMarketData = result.data;
      applyMarketFilters();
    }
  } catch (error) {
    console.error('Error fetching market data:', error);
  }
}

async function fetchScreenerData() {
  try {
    const response = await fetch(`${API_URL}/api/screener`);
    const result = await response.json();
    
    if (result.success && result.data) {
      allScreenerData = result.data;
      applyScreenerFilters();
    }
  } catch (error) {
    console.error('Error fetching screener data:', error);
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FILTER FUNCTIONS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function applyMarketFilters() {
  const sectorFilter = document.getElementById('market-sector-filter').value;
  const sortFilter = document.getElementById('market-sort-filter').value;
  
  let filtered = [...allMarketData];
  
  // Apply sector filter
  if (sectorFilter !== 'all') {
    filtered = filtered.filter(s => s.sector === sectorFilter);
  }
  
  // Apply sorting
  if (sortFilter === 'change') {
    filtered.sort((a, b) => Math.abs(b.pct) - Math.abs(a.pct));
  } else if (sortFilter === 'volume') {
    filtered.sort((a, b) => (b.vol || 0) - (a.vol || 0));
  } else if (sortFilter === 'price') {
    filtered.sort((a, b) => b.price - a.price);
  } else if (sortFilter === 'name') {
    filtered.sort((a, b) => a.name.localeCompare(b.name));
  }
  
  // Render
  const tbody = document.getElementById('market-table');
  tbody.innerHTML = filtered.map((s, i) => `
    <tr>
      <td style="color:var(--text-muted)">${i+1}</td>
      <td><span class="stock-name">${s.name}</span></td>
      <td><span class="sector-badge">${s.sector}</span></td>
      <td style="color:var(--text-primary);font-weight:600">‚Çπ${parseFloat(s.price).toLocaleString()}</td>
      <td class="${s.change >= 0 ? 'up' : 'down'}">${s.change >= 0 ? '+' : ''}${s.change}</td>
      <td class="${s.pct >= 0 ? 'up' : 'down'}">${s.pct >= 0 ? '+' : ''}${s.pct}%</td>
      <td>${s.vol || 'N/A'}</td>
      <td>${s.cap}</td>
    </tr>
  `).join('');
}

function applyScreenerFilters() {
  const sectorFilter = document.getElementById('screener-sector-filter').value;
  const peFilter = document.getElementById('screener-pe-filter').value;
  const roeFilter = document.getElementById('screener-roe-filter').value;
  
  let filtered = [...allScreenerData];
  
  // Apply sector filter
  if (sectorFilter !== 'all') {
    filtered = filtered.filter(s => s.sector === sectorFilter);
  }
  
  // Apply P/E filter
  if (peFilter !== 'all') {
    if (peFilter === '0-15') {
      filtered = filtered.filter(s => s.pe < 15);
    } else if (peFilter === '15-30') {
      filtered = filtered.filter(s => s.pe >= 15 && s.pe < 30);
    } else if (peFilter === '30-50') {
      filtered = filtered.filter(s => s.pe >= 30 && s.pe < 50);
    } else if (peFilter === '50+') {
      filtered = filtered.filter(s => s.pe >= 50);
    }
  }
  
  // Apply ROE filter
  if (roeFilter !== 'all') {
    if (roeFilter === '20+') {
      filtered = filtered.filter(s => s.roe > 20);
    } else if (roeFilter === '15+') {
      filtered = filtered.filter(s => s.roe > 15);
    } else if (roeFilter === '10+') {
      filtered = filtered.filter(s => s.roe > 10);
    }
  }
  
  // Render
  const tbody = document.getElementById('screener-table');
  tbody.innerHTML = filtered.map((s, i) => `
    <tr>
      <td style="color:var(--text-muted)">${i+1}</td>
      <td><span class="stock-name">${s.name}</span></td>
      <td><span class="sector-badge">${s.sector}</span></td>
      <td style="color:var(--text-primary);font-weight:600">‚Çπ${parseFloat(s.price).toLocaleString()}</td>
      <td>${s.pe}</td>
      <td class="${s.roe >= 18 ? 'up' : ''}">${s.roe}%</td>
      <td>${s.cap}</td>
      <td>‚Çπ${parseFloat(s.hi).toLocaleString()}</td>
      <td>‚Çπ${parseFloat(s.lo).toLocaleString()}</td>
      <td class="${s.de > 0.3 ? 'down' : ''}">${s.de}</td>
      <td class="${s.div >= 2 ? 'up' : ''}">${s.div}%</td>
    </tr>
  `).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INITIALIZE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

async function init() {
  await fetchIndices();
  await fetchTopGainers();
  await fetchTopLosers();
  await fetchMostActive();
  await fetch52WHighs();
  await fetch52WLows();
  await fetchMarketData();
  await fetchScreenerData();
  
  // Auto-refresh every 30 seconds
  setInterval(() => {
    fetchIndices();
    fetchTopGainers();
    fetchTopLosers();
    fetchMostActive();
    fetch52WHighs();
    fetch52WLows();
    fetchMarketData();
    fetchScreenerData();
  }, 30000);
}

init();
</script>
</body>
</html>
